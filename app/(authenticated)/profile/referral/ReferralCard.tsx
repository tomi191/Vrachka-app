"use client";

import { useState } from "react";
import { Copy, Check, Share2 } from "lucide-react";

interface ReferralCardProps {
  code: string;
  usesCount: number;
}

export function ReferralCard({ code, usesCount }: ReferralCardProps) {
  const [copied, setCopied] = useState(false);

  const referralUrl = `${window.location.origin}/auth/register?ref=${code}`;

  const copyToClipboard = async () => {
    try {
      await navigator.clipboard.writeText(referralUrl);
      setCopied(true);
      setTimeout(() => setCopied(false), 2000);
    } catch (err) {
      console.error("Failed to copy:", err);
    }
  };

  const shareReferral = async () => {
    if (navigator.share) {
      try {
        await navigator.share({
          title: "–ü—Ä–∏—Å—ä–µ–¥–∏–Ω–∏ —Å–µ –∫—ä–º Vrachka",
          text: `–ò–∑–ø–æ–ª–∑–≤–∞–π –º–æ—è –∫–æ–¥ ${code} –∏ –ø–æ–ª—É—á–∏ —Å–ø–µ—Ü–∏–∞–ª–Ω–∞ –æ—Ç—Å—Ç—ä–ø–∫–∞!`,
          url: referralUrl,
        });
      } catch (err) {
        console.error("Error sharing:", err);
      }
    } else {
      // Fallback to copy
      copyToClipboard();
    }
  };

  return (
    <div className="space-y-4">
      {/* Your Code */}
      <div>
        <label className="block text-sm text-zinc-400 mb-2">–¢–≤–æ—è—Ç –∫–æ–¥</label>
        <div className="p-4 bg-zinc-950 border border-zinc-800 rounded-lg text-center">
          <p className="text-2xl font-bold text-accent-400 tracking-wider">
            {code}
          </p>
        </div>
      </div>

      {/* Referral Link */}
      <div>
        <label className="block text-sm text-zinc-400 mb-2">
          –†–µ—Ñ–µ—Ä–µ–Ω—Ç–µ–Ω –ª–∏–Ω–∫
        </label>
        <div className="flex gap-2">
          <div className="flex-1 px-4 py-3 bg-zinc-950 border border-zinc-800 rounded-lg text-zinc-300 text-sm truncate">
            {referralUrl}
          </div>
          <button
            onClick={copyToClipboard}
            className="px-4 py-3 bg-accent-600 hover:bg-accent-700 text-white rounded-lg transition-colors flex items-center gap-2"
            title="–ö–æ–ø–∏—Ä–∞–π –ª–∏–Ω–∫"
          >
            {copied ? (
              <Check className="w-4 h-4" />
            ) : (
              <Copy className="w-4 h-4" />
            )}
          </button>
        </div>
      </div>

      {/* Share Buttons */}
      <div className="space-y-2">
        <button
          onClick={shareReferral}
          className="w-full px-4 py-3 border border-accent-600 text-accent-300 rounded-lg hover:bg-accent-900/20 transition-colors flex items-center justify-center gap-2"
        >
          <Share2 className="w-4 h-4" />
          –°–ø–æ–¥–µ–ª–∏ —Å –ø—Ä–∏—è—Ç–µ–ª–∏
        </button>

        <div className="grid grid-cols-2 gap-2">
          {/* WhatsApp Share */}
          <a
            href={`https://wa.me/?text=${encodeURIComponent(
              `üåü –ü—Ä–∏—Å—ä–µ–¥–∏–Ω–∏ —Å–µ –∫—ä–º Vrachka —Å –º–æ—è –∫–æ–¥ ${code} –∏ –ø–æ–ª—É—á–∏ —Å–ø–µ—Ü–∏–∞–ª–Ω–∞ –Ω–∞–≥—Ä–∞–¥–∞! ${referralUrl}`
            )}`}
            target="_blank"
            rel="noopener noreferrer"
            className="px-4 py-2 bg-[#25D366] hover:bg-[#20ba5a] text-white rounded-lg transition-colors flex items-center justify-center gap-2 text-sm"
          >
            <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
              <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
            </svg>
            WhatsApp
          </a>

          {/* Viber Share */}
          <a
            href={`viber://forward?text=${encodeURIComponent(
              `üåü –ü—Ä–∏—Å—ä–µ–¥–∏–Ω–∏ —Å–µ –∫—ä–º Vrachka —Å –º–æ—è –∫–æ–¥ ${code} –∏ –ø–æ–ª—É—á–∏ —Å–ø–µ—Ü–∏–∞–ª–Ω–∞ –Ω–∞–≥—Ä–∞–¥–∞! ${referralUrl}`
            )}`}
            className="px-4 py-2 bg-[#7360f2] hover:bg-[#5a4ac7] text-white rounded-lg transition-colors flex items-center justify-center gap-2 text-sm"
          >
            <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
              <path d="M11.398.002C9.473.028 5.331.344 2.762 2.844.76 4.798.04 7.563.006 10.907c-.036 3.344.315 9.416 8.252 9.416h.008l-.007 3.677s-.047.695.434.842c.579.177 1.041-.259 2.027-1.334.549-.598 1.303-1.461 1.875-2.127 5.17.436 9.134-1.495 9.605-4.725.487-3.334-.315-6.866-3.88-9.314-2.57-1.764-5.519-2.204-7.922-2.24zm.08 1.988c2.158.024 4.853.408 7.13 1.957 2.905 1.977 3.344 4.711 2.963 7.445-.366 2.625-3.443 3.972-7.723 3.572 0 0-2.756 3.322-3.619 4.218-.131.138-.282.18-.368.153-.121-.037-.155-.19-.155-.421l.018-5.162c-6.23-.016-6.644-4.847-6.618-7.724.025-2.877.574-5.189 2.274-6.853 2.023-1.972 5.674-2.207 6.098-2.185zm-4.071 2.446c-.385.015-.735.195-.951.512-.645.951-1.03 1.991-1.03 3.075 0 .74.206 1.455.561 2.095-.032.096-.045.201-.037.31.021.286.125.549.3.761l.367.381c.033.033.069.062.107.09.075.057.154.103.236.138.041.018.083.033.126.045.021.006.043.01.065.014.043.008.086.013.129.015h.004c.021.001.042 0 .063-.002h.003l.004-.001c.277-.024.528-.138.709-.302.133-.12.233-.27.293-.438l.05-.138c.177.041.357.077.539.107l.005.001c.009.001.018.003.027.004l.009.002c.135.021.271.04.408.056l.021.002.021.002c.13.014.261.026.393.036h.001c.007 0 .014.001.021.001.136.01.272.017.409.021l.015.001c.007 0 .014 0 .021.001.143.003.287.005.431.005s.288-.002.431-.005l.021-.001.015-.001c.137-.004.273-.011.409-.021.007 0 .014-.001.021-.001h.001c.132-.01.263-.022.393-.036l.021-.002.021-.002c.137-.016.273-.035.408-.056l.009-.002c.009-.001.018-.003.027-.004l.005-.001c.182-.03.362-.066.539-.107l.05.138c.06.168.16.318.293.438.181.164.432.278.709.302h.003l.004.001h.003c.021.002.042.003.063.002h.004c.043-.002.086-.007.129-.015.022-.004.044-.008.065-.014.043-.012.085-.027.126-.045.082-.035.161-.081.236-.138.038-.028.074-.057.107-.09l.367-.381c.175-.212.279-.475.3-.761.008-.109-.005-.214-.037-.31.355-.64.561-1.355.561-2.095 0-1.084-.385-2.124-1.03-3.075-.216-.317-.566-.497-.951-.512-.385-.014-.778.166-1.044.479-.266.314-.4.731-.303 1.15.023.099.063.192.117.277.207.329.433.641.679.932.246.291.512.562.793.812.053.047.105.094.159.141.055.047.109.094.164.141.053.046.107.093.161.138.055.046.109.091.164.136.054.045.109.091.163.136.054.045.109.09.163.134.055.045.109.089.164.133.054.044.109.089.164.132.055.044.109.088.164.132.054.044.109.088.164.132.055.044.109.087.164.131.054.044.109.088.164.131.055.044.109.087.164.13.054.043.109.087.164.131.054.043.109.086.164.129.055.043.109.086.164.129.054.043.109.086.164.128.055.043.109.085.164.128.054.042.109.085.164.127.055.042.109.085.164.127.054.042.109.084.164.126.055.042.109.084.164.126.054.042.109.083.164.125.055.042.109.083.164.125.054.041.109.083.164.124.055.041.109.082.164.123.054.041.109.082.164.123.055.041.109.081.164.122.054.041.109.081.164.122.055.041.109.081.164.121.054.04.109.08.164.121.055.04.109.08.164.12.054.04.109.08.164.119.055.04.109.079.164.119.054.04.109.079.164.118.055.039.109.079.164.118.054.039.109.078.164.117.055.039.109.078.164.117.054.039.109.077.164.116.055.039.109.077.164.116.054.038.109.077.164.115.055.038.109.076.164.114.054.038.109.076.164.114.055.038.109.076.164.113.054.038.109.075.164.113.055.037.109.075.164.112.054.037.109.075.164.112.055.037.109.074.164.111.054.037.109.074.164.111.055.037.109.073.164.11.054.037.109.074.164.11.055.036.109.073.164.109.054.036.109.073.164.109.055.036.109.072.164.108.054.036.109.072.164.108.055.036.109.071.164.107.054.036.109.071.164.106.055.036.109.071.164.106.054.035.109.071.164.106.055.035.109.07.164.105.054.035.109.07.164.104.055.035.109.069.164.104.054.035.109.069.164.103.055.035.109.069.164.103.054.034.109.069.164.103.055.034.109.068.164.102.054.034.109.068.164.102.055.034.109.067.164.101.054.034.109.067.164.101.055.034.109.067.164.1.054.033.109.067.164.1.055.033.109.066.164.099.054.033.109.066.164.099.055.033.109.065.164.098.054.033.109.066.164.098.055.033.109.065.164.097.054.032.109.065.164.097.055.032.109.064.164.096.054.032.109.064.164.096.055.032.109.064.164.095.054.032.109.063.164.095.055.032.109.063.164.094.054.031.109.063.164.094.055.031.109.062.164.093.054.031.109.062.164.093.055.031.109.062.164.092.054.031.109.061.164.092.055.03.109.061.164.091.054.03.109.061.164.091.055.03.109.06.164.09.054.03.109.06.164.089.055.03.109.059.164.089.054.03.109.059.164.088.055.029.109.059.164.088.054.029.109.058.164.087.055.029.109.058.164.087.054.029.109.057.164.086.055.029.109.057.164.086.054.028.109.057.164.085.055.028.109.056.164.084.054.028.109.056.164.084.055.028.109.055.164.083.054.028.109.055.164.082.055.027.109.055.164.082.054.027.109.054.164.081.055.027.109.054.164.081.054.027.109.054.164.08.055.027.109.053.164.08.054.026.109.053.164.079.055.026.109.052.164.078.054.026.109.052.164.078.055.026.109.052.164.077.054.026.109.051.164.077.055.026.109.051.164.076.054.025.109.051.164.076.055.025.109.05.164.075.054.025.109.05.164.074.055.025.109.049.164.074.054.025.109.049.164.073.055.024.109.049.164.073.054.024.109.048.164.072.055.024.109.048.164.071.054.024.109.047.164.071.055.024.109.047.164.07.054.023.109.047.164.07.055.023.109.046.164.069.054.023.109.046.164.068.055.023.109.045.164.068.054.022.109.045.164.067.055.022.109.045.164.067.054.022.109.044.164.066.055.022.109.044.164.065.054.022.109.043.164.065.055.021.109.043.164.064.054.021.109.043.164.064.055.021.109.042.164.063.054.021.109.042.164.062.055.021.109.041.164.061.054.02.109.041.164.061.055.02.109.041.164.06.054.02.109.04.164.06.055.02.109.039.164.059.054.02.109.039.164.058.055.019.109.039.164.058.054.019.109.038.164.057.055.019.109.038.164.056.054.019.109.037.164.056.055.019.109.037.164.055.054.018.109.037.164.055.055.018.109.036.164.054.054.018.109.036.164.053.055.018.109.035.164.053.054.017.109.035.164.052.055.017.109.035.164.052.054.017.109.034.164.051.055.017.109.034.164.05.054.017.109.033.164.05.055.017.109.033.164.049.054.016.109.033.164.049.055.016.109.032.164.048.054.016.109.032.164.047.055.016.109.031.164.047.054.016.109.031.164.046.055.015.109.031.164.045.054.015.109.03.164.045.055.015.109.03.164.044.054.015.109.029.164.043.055.015.109.029.164.043.054.014.109.029.164.042.055.014.109.028.164.041.054.014.109.028.164.041.055.014.109.027.164.04.054.014.109.027.164.039.055.014.109.027.164.039.054.013.109.026.164.038.055.013.109.026.164.037.054.013.109.026.164.037.055.013.109.025.164.036.054.013.109.025.164.035.055.012.109.024.164.035.054.012.109.024.164.034.055.012.109.024.164.033.054.012.109.023.164.033.055.012.109.023.164.032.054.011.109.022.164.032.055.011.109.022.164.031.054.011.109.022.164.03.055.011.109.021.164.03.054.011.109.021.164.029.055.01.109.02.164.028.054.01.109.02.164.028.055.01.109.019.164.027.054.01.109.019.164.026.055.01.109.019.164.026.054.009.109.018.164.025.055.009.109.018.164.024.054.009.109.017.164.024.055.009.109.017.164.023.054.009.109.017.164.022.055.008.109.016.164.022.054.008.109.016.164.021.055.008.109.015.164.02.054.008.109.015.164.019.055.008.109.015.164.019.054.007.109.014.164.018.055.007.109.014.164.017.054.007.109.014.164.016.055.007.109.013.164.016.054.007.109.013.164.015.055.006.109.012.164.014.054.006.109.012.164.014.055.006.109.011.164.013.054.006.109.011.164.012.055.006.109.011.164.011.054.005.109.01.164.011.055.005.109.01.164.01.054.005.109.009.164.009.055.005.109.009.164.008.054.004.109.008.164.008.055.004.109.008.164.007.054.004.109.007.164.006.055.004.109.007.164.006.054.003.109.006.164.005.055.003.109.006.164.004.054.003.109.005.164.004.055.003.109.005.164.003.054.002.109.004.164.002.055.002.109.004.164.002.054.002.109.003.164.001.055.001.109.003.164 0 .055.001.109.002.164 0h.328c.055 0 .109-.001.164-.001l.164-.002c.055-.001.109-.002.164-.003.054-.001.109-.003.164-.004.055-.001.109-.003.164-.004.054-.002.109-.004.164-.005.055-.002.109-.004.164-.006.054-.002.109-.004.164-.006.055-.002.109-.005.164-.007.054-.002.109-.005.164-.008.055-.003.109-.005.164-.008.054-.003.109-.006.164-.009.055-.003.109-.006.164-.009.054-.003.109-.007.164-.01.055-.003.109-.007.164-.011.054-.004.109-.007.164-.011.055-.004.109-.008.164-.012.054-.004.109-.008.164-.013.055-.004.109-.009.164-.014.054-.005.109-.009.164-.014.055-.005.109-.01.164-.015.054-.005.109-.01.164-.016.055-.005.109-.011.164-.017.054-.006.109-.011.164-.017.055-.006.109-.012.164-.019.054-.006.109-.013.164-.019.055-.007.109-.013.164-.02.054-.007.109-.014.164-.021.055-.007.109-.014.164-.022.054-.007.109-.015.164-.023.055-.008.109-.016.164-.024.054-.008.109-.016.164-.025.055-.008.109-.017.164-.026.054-.009.109-.017.164-.026.055-.009.109-.018.164-.028.054-.009.109-.019.164-.029.055-.01.109-.02.164-.03.054-.01.109-.02.164-.031.055-.01.109-.021.164-.032.054-.011.109-.022.164-.033.055-.011.109-.022.164-.034.054-.011.109-.023.164-.035.055-.012.109-.024.164-.036.054-.012.109-.024.164-.037.055-.012.109-.025.164-.038.054-.013.109-.026.164-.039.055-.013.109-.026.164-.04.054-.013.109-.027.164-.041.055-.014.109-.028.164-.042.054-.014.109-.028.164-.043.055-.014.109-.029.164-.044.054-.015.109-.03.164-.045.055-.015.109-.03.164-.046.054-.015.109-.031.164-.047.055-.016.109-.032.164-.048.054-.016.109-.032.164-.049.055-.016.109-.033.164-.05.054-.017.109-.034.164-.051.055-.017.109-.034.164-.052.054-.017.109-.035.164-.053.055-.018.109-.036.164-.054.054-.018.109-.037.164-.056.055-.019.109-.037.164-.057.054-.019.109-.038.164-.058.055-.019.109-.039.164-.059.054-.02.109-.04.164-.06.055-.02.109-.041.164-.061.054-.021.109-.042.164-.063.055-.021.109-.042.164-.064.054-.021.109-.043.164-.065.055-.022.109-.044.164-.066.054-.022.109-.044.164-.067.055-.022.109-.045.164-.068.054-.023.109-.046.164-.069.055-.023.109-.047.164-.07.054-.024.109-.048.164-.072.055-.024.109-.048.164-.073.054-.024.109-.049.164-.074.055-.025.109-.05.164-.075.054-.025.109-.051.164-.076.055-.026.109-.052.164-.078.054-.026.109-.052.164-.079.055-.026.109-.053.164-.08.054-.027.109-.054.164-.081.055-.027.109-.055.164-.082.054-.027.109-.055.164-.083.055-.028.109-.056.164-.084.054-.028.109-.057.164-.086.055-.029.109-.058.164-.087.054-.029.109-.058.164-.088.055-.029.109-.059.164-.089.054-.03.109-.06.164-.09.055-.03.109-.061.164-.092.054-.031.109-.061.164-.093.055-.031.109-.062.164-.093.054-.031.109-.063.164-.094.055-.032.109-.063.164-.095.054-.032.109-.064.164-.096.055-.032.109-.064.164-.097.054-.032.109-.065.164-.098.055-.033.109-.065.164-.098.054-.033.109-.066.164-.099.055-.033.109-.067.164-.1.054-.034.109-.067.164-.101.055-.034.109-.068.164-.102.054-.034.109-.069.164-.103.055-.035.109-.069.164-.104.054-.035.109-.07.164-.105.055-.035.109-.07.164-.105.054-.036.109-.071.164-.107.055-.036.109-.072.164-.108.054-.036.109-.073.164-.109.055-.036.109-.073.164-.11.054-.037.109-.074.164-.11.055-.037.109-.074.164-.111.054-.037.109-.075.164-.112.055-.038.109-.075.164-.113.054-.038.109-.076.164-.114.055-.038.109-.077.164-.115.054-.038.109-.077.164-.116.055-.039.109-.078.164-.117.054-.039.109-.078.164-.118.055-.039.109-.079.164-.119.054-.04.109-.08.164-.12.055-.04.109-.081.164-.121.054-.041.109-.081.164-.122.055-.041.109-.082.164-.123.054-.041.109-.083.164-.124.055-.042.109-.083.164-.125.054-.042.109-.084.164-.126.055-.042.109-.084.164-.127.054-.042.109-.085.164-.127.055-.043.109-.086.164-.128.054-.043.109-.086.164-.129.055-.043.109-.087.164-.13.054-.043.109-.087.164-.131.055-.044.109-.088.164-.132.054-.044.109-.089.164-.132.055-.044.109-.089.164-.133.054-.045.109-.09.164-.134.055-.045.109-.091.164-.136.054-.046.109-.091.164-.137.055-.046.109-.092.164-.138.054-.046.109-.093.164-.14.055-.047.109-.094.164-.141.281-.25.547-.521.793-.812.246-.291.472-.603.679-.932.054-.085.094-.178.117-.277.097-.419-.037-.836-.303-1.15-.266-.313-.659-.493-1.044-.479z"/>
            </svg>
            Viber
          </a>
        </div>
      </div>

      {/* Stats */}
      <div className="p-4 bg-zinc-950/50 border border-zinc-800 rounded-lg">
        <div className="flex items-center justify-between">
          <span className="text-zinc-400">–ò–∑–ø–æ–ª–∑–≤–∞–Ω–∏—è</span>
          <span className="text-xl font-bold text-zinc-100">{usesCount}</span>
        </div>
      </div>
    </div>
  );
}
