# MCP интеграция със Supabase

Тази конфигурация позволява на MCP клиент (напр. Codex CLI, Claude Desktop, VSCode MCP клиенти) да достъпва вашия Supabase проект за инспекция на схема/данни чрез MCP инструменти.

## Конфигурация

Файл: `Vrachka-app/mcp.json`

- Добавени са HTTP MCP сървър и хедъри с env променливи:
```
{
  "mcpServers": {
    "supabase": {
      "type": "http",
      "url": "https://mcp.supabase.com/mcp",
      "headers": {
        "x-supabase-url": "${NEXT_PUBLIC_SUPABASE_URL}",
        "x-supabase-key": "${SUPABASE_SERVICE_ROLE_KEY}"
      }
    }
  }
}
```

Уверете се, че следните променливи са налични в средата, която стартира MCP клиента:
- `NEXT_PUBLIC_SUPABASE_URL`
- `SUPABASE_SERVICE_ROLE_KEY`

В Vercel/локално можете да ги поставите в `.env.local` или да ги експортирате като env.

## Какво да очаквате

В зависимост от MCP сървъра на Supabase, инструментите обикновено включват:
- Извличане на списък с таблици, изгледи и функции
- Инспекция на RLS политики
- Изпълнение на рийд‑онли заявки (с ограничения)

Забележка: Използваният ключ е `service_role`, който има високи права. Дръжте MCP клиента на доверена машина и не споделяйте ключа публично.

## Стартиране

- Ако ползвате Codex CLI/друг MCP‑съвместим клиент, просто стартирайте клиента в папката на проекта или посочете път към `mcp.json`.
- Клиентът ще зареди MCP сървъра и ще предостави инструменти за работа със Supabase.

## Отстраняване на проблеми

- Ако виждате 401/403: проверете `x-supabase-key` и дали е service role ключ.
- Ако няма инструменти: проверете, че клиентът на MCP поддържа HTTP MCP сървъри и че URL е достижим.
- Ако проектът е на друг Supabase URL: актуализирайте `NEXT_PUBLIC_SUPABASE_URL`.

## Алтернатива: Локален MCP сървър

Ако предпочитате локален MCP сървър:
- Създайте custom MCP процес (Node.js) с `@modelcontextprotocol/sdk` и `@supabase/supabase-js`
- Експонирайте инструменти за schema/заявки
- Регистрирайте го в `mcp.json` с `type: "command"` и `command: "node"`, `args: ["path/to/server.js"]`

Това дава пълен контрол върху допустимите операции и логване.
